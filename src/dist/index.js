const firebaseTest=require("firebase-functions-test"),admin=require("firebase-admin");class FirestoreTest{constructor(a,b){this.config=a,this.pathToServiceAccountKey=b}firebaseTest(){return firebaseTest(this.config,this.pathToServiceAccountKey)}admin(){return admin.apps.length||admin.initializeApp(),admin}firestore(){return this.admin().firestore()}testDb(a){const b=this.firestore(),c={},d=b.batch(),e=b.batch();return Object.keys(a).forEach(f=>{const g=b.doc(f);d.set(g,a[f]),e.delete(g),c[f]=g}),d.commit().then(()=>({docs:a,refs:c,makeDocumentSnapshot:b=>this.firebaseTest().firestore.makeDocumentSnapshot(a[b],b),before:b=>a[b],after:a=>c[a].get().then(a=>a.data()),destroy:()=>e.commit()}))}}module.exports=(a,b)=>new FirestoreTest(a,b);